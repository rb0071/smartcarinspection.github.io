<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LIFF Video Upload</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body {
      font-family: "Prompt", sans-serif;
      text-align: center;
      margin: 20px;
      background-color: #f8f8f8;
    }
    h1 {
      color: #333;
    }
    video {
      width: 100%;
      max-width: 400px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button, input[type=file] {
      margin: 10px;
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: #06C755;
      color: white;
      cursor: pointer;
    }
    button:disabled {
      background-color: #aaa;
    }
    #status {
      margin-top: 15px;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>

  <h1>üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠</h1>

  <!-- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏ô LINE -->
  <input type="file" id="videoInput" accept="video/*" capture="camera">

  <!-- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ -->
  <button id="startBtn">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</button>
  <video id="video" autoplay playsinline></video>
  <button id="recordBtn" disabled>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏î‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠</button>
  <button id="stopBtn" disabled>‡∏´‡∏¢‡∏∏‡∏î‡∏≠‡∏±‡∏î</button>

  <div id="status"></div>

  <script>
    // ===== LIFF Initialization =====
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        await liff.init({ liffId: "YOUR_LIFF_ID" }); // <-- ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        console.log("LIFF initialized");
      } catch (err) {
        console.warn("LIFF init failed:", err);
      }
    });

    // ===== ‡πÉ‡∏ä‡πâ input file (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏ô LIFF) =====
    const videoInput = document.getElementById("videoInput");
    videoInput.addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      showDialog("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...");

      const formData = new FormData();
      formData.append("file", file);

      try {
        const res = await fetch("https://yourserver.com/upload", { // üëà ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
          method: "POST",
          body: formData
        });
        const data = await res.json();
        showDialog(data.success ? "‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" : "‚ùå ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      } catch (err) {
        showDialog("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
      }
    });

    // ===== ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö browser ‡∏õ‡∏Å‡∏ï‡∏¥ =====
    const startBtn = document.getElementById("startBtn");
    const recordBtn = document.getElementById("recordBtn");
    const stopBtn = document.getElementById("stopBtn");
    const video = document.getElementById("video");

    let mediaRecorder;
    let recordedChunks = [];

    startBtn.onclick = async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        video.srcObject = stream;
        recordBtn.disabled = false;

        recordBtn.onclick = () => startRecording(stream);
      } catch (err) {
        showDialog("‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + err.message);
      }
    };

    function startRecording(stream) {
      recordedChunks = [];
      mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm" });

      mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) recordedChunks.push(e.data);
      };

      mediaRecorder.onstop = uploadVideo;

      mediaRecorder.start();
      showDialog("üé• ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏î‡∏ß‡∏µ‡∏î‡∏µ‡πÇ‡∏≠...");
      recordBtn.disabled = true;
      stopBtn.disabled = false;
      stopBtn.onclick = () => mediaRecorder.stop();
    }

    async function uploadVideo() {
      const blob = new Blob(recordedChunks, { type: "video/webm" });
      const formData = new FormData();
      formData.append("file", blob, "video.webm");

      showDialog("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...");

      try {
        const res = await fetch("https://yourserver.com/upload", { // üëà ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
          method: "POST",
          body: formData
        });
        const data = await res.json();
        showDialog(data.success ? "‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" : "‚ùå ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      } catch (err) {
        showDialog("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
      }

      recordBtn.disabled = false;
      stopBtn.disabled = true;
    }

    function showDialog(msg) {
      document.getElementById("status").textContent = msg;
      console.log(msg);
    }
  </script>

</body>
</html>
